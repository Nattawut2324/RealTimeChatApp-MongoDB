<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('templates/head') %>
</head>
<body>
  <%- include('templates/header.ejs') %>
  <link rel="stylesheet" href="/stylesheets/messageboxStyle.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" >
  <div>
    <input type="hidden" id="user_id" value="<%= locals.user._id %>">
    <input type="hidden" id="room_id" value="<%= locals.room._id %>">
    <input type="hidden" id="user_name" value="<%= locals.user.name %>">
    <div class="container">
      <div class="row">
        <div class="col-3 card">
          <div class="card-header text-center row">
            <div class="col-9 d-flex justify-content-center align-items-center" style="height: 50px;">
              <h5>Your Chats</h5>
            </div>
            <div class="col-3" style="height: 50px;">
              <i class="bi bi-plus-circle-fill text-primary" style="font-size: 30px;"></i>
            </div>
          </div>
          <div>
            <%- include('roomList') %>
          </div>
        </div>
        <div class="col">
            <div class="card">
                <div class="card-header d-flex justify-content-between" style="height: 40px;">
                    <div class="">
                        <%= locals.room.name %>
                    </div>
                    <% if (locals.room._id !== -1) { %>
                        <div>
                            <input type="hidden" id="joinroom-url" value="http://localhost:3000/rooms/join?room=<%= locals.room._id %>">
                            <a class="d-block" href="#" onclick="copyContent()"><i class="me-1 bi bi-link"></i>Invite</a>
                        </div>
                    <% } %>
                </div>
                <div class="message-container">
                    <div class="message-box">
                        <% if(locals.msgs.length > 0){ %>
                            <ul class="list-group list-group-flush" id="message-list">
                                <% locals.msgs.reverse().forEach(e => { %>
                                    <div class="msg-box my-2 <%= (e.sender._id.toString() === locals.user._id.toString()) ? 'msg-this' : 'msg-other' %>">
                                        <div class="msg-info-con">
                                            <div class="msg-info me-2"><%= (e.sender._id.toString() === locals.user._id.toString()) ? 'You' : e.sender.name %></div>
                                        </div>
                                        <div class="msg-text-con">
                                            <div class="img-con">
                                                <img class="profile-img" src="<%= '/images/'+e.sender.image %>">
                                            </div>
                                            <div class="msg-text"><%= e.text %></div>
                                        </div>
                                        <div class="msg-info"><%= e.date %></div>
            
                                    </div>
                                <% }) %>
                            </ul>
                        <% } 
                        else{ %>
                            <div id="no-chat" class="h-100 d-flex justify-content-center align-items-center">
                                <div>
                                    <h4>No chat</h4>
                                </div>
                            </div>
                        <% } %> 
            
                    </div>
                </div>
                <div class="info"></div>
                <div class="card-footer">
                  <div class="input-group">
                    <form class="input-group" action="/test/newmsg" method="post">
                        <input type="hidden" name="room" value="<%= locals.room._id %>">
                        <input
                          type="text"
                          class="form-control"
                          id="message-input" 
                          name="text"
                          placeholder="Send new message"
                          autocomplete="off"
                        />
                        <div class="input-group-append">
                          <button class="btn btn-success" type="submit" id="messageBtn">
                            Send
                          </button>
                        </div>
                    </form>
                  </div>
                </div>
              </div>
        </div>
      </div>
    </div>
    <%- include('templates/footer') %>
    <script>
      const copyContent = async () =>{
         let text = document.getElementById('joinroom-url').value;
         const temp = document.createElement('textarea');
         temp.value = text;
         document.body.appendChild(temp)
         temp.select()
         document.execCommand('copy')
         document.body.removeChild(temp)
         
      }
    </script>
  </div>
</body>
</html>
 







